---
const baseUrl = import.meta.env.BASE_URL;
---

<section class="video-tour" id="video">
  <div class="container">
    <h2 class="section-title text-center">Video Tour</h2>
    <p class="lead text-center text-muted">
      Walk through the property from wherever you are.
    </p>

    <div class="video-wrapper">
      <video
        id="tour-video"
        class="tour-video"
        controls
        preload="metadata"
        poster={`${baseUrl}og.jpg`}
      >
        <source src={`${baseUrl}media/video/hero.mp4`} type="video/mp4" />
        Your browser does not support the video tag.
      </video>
      <div class="video-fallback" id="video-fallback">
        <div class="video-fallback-content">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polygon points="5 3 19 12 5 21 5 3" />
          </svg>
          <p>Video tour coming soon</p>
          <p class="text-muted" style="font-size: 0.9rem;">
            Add video files to <code>public/media/video/</code>
          </p>
        </div>
      </div>
    </div>

    <p class="disclaimer">
      Video may include adjacent areas not included in the sale.
      No rights or access are implied. See Information Packet for details.
    </p>
  </div>
</section>

<style>
  .video-tour {
    background: var(--color-bg);
  }

  .section-title {
    margin-bottom: 0.5rem;
  }

  .lead {
    margin-bottom: var(--spacing-lg);
  }

  .video-wrapper {
    position: relative;
    max-width: 1000px;
    margin: 0 auto var(--spacing-md);
    border-radius: 8px;
    overflow: hidden;
    background: #000;
  }

  .tour-video {
    width: 100%;
    aspect-ratio: 16/9;
    display: block;
    background: #000;
  }

  .video-fallback {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #1a3a28 0%, #0d1f14 100%);
    color: white;
  }

  .video-fallback.show {
    display: flex;
  }

  .video-fallback-content {
    text-align: center;
    opacity: 0.7;
  }

  .video-fallback-content svg {
    margin-bottom: 1rem;
  }

  .video-fallback-content p {
    margin: 0.5rem 0;
  }

  .video-fallback-content code {
    background: rgba(255, 255, 255, 0.1);
    padding: 0.2em 0.4em;
    border-radius: 3px;
  }
</style>

<script>
  const video = document.getElementById('tour-video') as HTMLVideoElement;
  const fallback = document.getElementById('video-fallback');

  if (video && fallback) {
    video.addEventListener('error', () => {
      fallback.classList.add('show');
      video.style.display = 'none';
    });

    // Check if video source is loadable
    video.addEventListener('loadedmetadata', () => {
      fallback.classList.remove('show');
      video.style.display = 'block';
    });
  }
</script>
